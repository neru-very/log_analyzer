# Log receiver and analyzer

## What is
### recv.py
HTTPサーバのログをrsyslog経由で受信し，データベースに保存します。  
<img src ="https://github.com/neru-very/log_analyzer/blob/master/img/recv.png" width="400" height="260">

### analyzer.py
analyzer.pyはHTTPサーバのaccessログを読み込み，解析します。

### show.py
show.pyはデータベース内の情報を可視化するためのツールです。

## How to use
### recv.py
recv.pyはpythonの標準ライブラリのみで動作します。  
データベースにはsqlite3を使用します。

```
> python recv.py

 ###     ######  ######### ##   #####
 ###     ######  ######### ##  ######
 ###     ###        ###    ##  ###
 ###     ######     ###    ##  #####
 ###     ######     ###         #####
 ###     ###        ###           ###
 ######  ######     ###        ######
 ######  ######     ###        #####


 ###  ###    ####    #######    ######    ######  ####   ###  #######  ####   ###   ########
 ###  ###   ######   ########   #######   ######  ### #  ###  #######  ### #  ###  ##########
 ###  ###  ###  ###  ###  ###   ###  ###  ###     ### #  ###    ###    ### #  ###  ###
 ########  ###  ###  ###  ###   ###   ##  ######  ### #  ###    ###    ### #  ###  ###  #####
 ########  ########  #######    ###   ##  ######  ###  # ###    ###    ###  # ###  ###  #####
 ###  ###  ########  #######    ###  ###  ###     ###  # ###    ###    ###  # ###  ###    ###
 ###  ###  ###  ###  ###  ###   #######   ######  ###  # ###  #######  ###  # ###  ##########
 ###  ###  ###  ###  ###   ###  ######    ######  ###   ####  #######  ###   ####   ########

 --- 523 packet received
```

### analyzer.py
analyzer.pyはpythonの標準ライブラリのみで動作します。  
データベースにはsqlite3を使用します。  
  
#### ログファイルの読込，および更新

```
> python analyzer.py --update

----------------------------------------------------------------
Complelte access_log_serverA-20181120        serverA           1000 / 1000
Complelte access_log_serverA-20181121        serverA            500 / 500
Complelte access_log_serverB-20181120        serverB           1000 / 1000
Complelte access_log_serverB-20181121        serverB            500 / 500
Complelte access_log-20181120              localhost           1000 / 1000
Complelte access_log-20181121              localhost            500 / 500
Complelte access_log_serverA                 serverA            500 / 500
Complelte access_log_serverB                 serverB            500 / 500
Complelte access_log                       localhost            500 / 500

Result :
	serverA      has 2000 logs
	serverB      has 2000 logs
	localhost    has 2000 logs
----------------------------------------------------------------
```

#### 標準解析モード

```
> python analyzer.py

----------------------------------------------------------------
# serverA
COUNT    |  REQUEST
----------------------------------------------------------------
200      |  /test.html
----------------------------------------------------------------
200      |  /index.html
----------------------------------------------------------------
300      |  /テスト　テスト
----------------------------------------------------------------
300      |  /これはテストです
----------------------------------------------------------------
1000     |  /
----------------------------------------------------------------

# serverB
COUNT    |  REQUEST
----------------------------------------------------------------
200      |  /test.html
----------------------------------------------------------------
200      |  /index.html
----------------------------------------------------------------
300      |  /テスト　テスト
----------------------------------------------------------------
300      |  /これはテストです
----------------------------------------------------------------
1000     |  /
----------------------------------------------------------------

# localhost
COUNT    |  REQUEST
----------------------------------------------------------------
200      |  /test.html
----------------------------------------------------------------
200      |  /index.html
----------------------------------------------------------------
300      |  /テスト　テスト
----------------------------------------------------------------
300      |  /これはテストです
----------------------------------------------------------------
1000     |  /
----------------------------------------------------------------
```

#### 検索モード

```
> python analyzer.py --search KEYWORD

----------------------------------------------------------------
# serverA
----------------------------------------------------------------
2018/11/19 14:18:27    From: 127.0.0.1
*Request    : GET  200  /KETWORD
*Referer    : -
*User-Agent : ApacheBench/2.3
----------------------------------------------------------------
2018/11/19 14:18:27    From: 127.0.0.1
*Request    : GET  200  /KEYWORD
*Referer    : -
*User-Agent : ApacheBench/2.3
----------------------------------------------------------------

# serverB
----------------------------------------------------------------
2018/11/19 14:18:27    From: 127.0.0.1
*Request    : GET  200  /KEYWORD
*Referer    : -
*User-Agent : ApacheBench/2.3
----------------------------------------------------------------
2018/11/19 14:18:27    From: 127.0.0.1
*Request    : GET  200  /KEYWORD
*Referer    : -
*User-Agent : ApacheBench/2.3
----------------------------------------------------------------

# localhost
----------------------------------------------------------------
2018/11/19 14:18:27    From: 127.0.0.1
*Request    : GET  200  /KEYWORD
*Referer    : -
*User-Agent : ApacheBench/2.3
----------------------------------------------------------------
2018/11/19 14:18:27    From: 127.0.0.1
*Request    : GET  200  /KEYWORD
*Referer    : -
*User-Agent : ApacheBench/2.3
----------------------------------------------------------------
```

#### 時間解析モード

```
> python analyzer.py --time

----------------------------------------------------------------
# serverA
----------------------------------------------------------------
2018/11/20 02:24:57 - 2018/11/20 02:34:57 => 0
----------------------------------------------------------------
2018/11/20 02:14:57 - 2018/11/20 02:24:57 => 10
----------------------------------------------------------------
2018/11/20 02:04:57 - 2018/11/20 02:14:57 => 20
----------------------------------------------------------------
2018/11/20 01:54:57 - 2018/11/20 02:04:57 => 0
----------------------------------------------------------------
2018/11/20 01:44:57 - 2018/11/20 01:54:57 => 10
----------------------------------------------------------------
2018/11/20 01:34:57 - 2018/11/20 01:44:57 => 0
----------------------------------------------------------------

# serverB
----------------------------------------------------------------
2018/11/20 02:24:57 - 2018/11/20 02:34:57 => 0
----------------------------------------------------------------
2018/11/20 02:14:57 - 2018/11/20 02:24:57 => 10
----------------------------------------------------------------
2018/11/20 02:04:57 - 2018/11/20 02:14:57 => 20
----------------------------------------------------------------
2018/11/20 01:54:57 - 2018/11/20 02:04:57 => 0
----------------------------------------------------------------
2018/11/20 01:44:57 - 2018/11/20 01:54:57 => 10
----------------------------------------------------------------
2018/11/20 01:34:57 - 2018/11/20 01:44:57 => 0
----------------------------------------------------------------

# localhost
----------------------------------------------------------------
2018/11/20 02:24:57 - 2018/11/20 02:34:57 => 0
----------------------------------------------------------------
2018/11/20 02:14:57 - 2018/11/20 02:24:57 => 10
----------------------------------------------------------------
2018/11/20 02:04:57 - 2018/11/20 02:14:57 => 20
----------------------------------------------------------------
2018/11/20 01:54:57 - 2018/11/20 02:04:57 => 0
----------------------------------------------------------------
2018/11/20 01:44:57 - 2018/11/20 01:54:57 => 10
----------------------------------------------------------------
2018/11/20 01:34:57 - 2018/11/20 01:44:57 => 0
----------------------------------------------------------------

----------------------------------------------------------------
```

### show.py
